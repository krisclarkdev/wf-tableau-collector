mkdir -p /usr/local/wftableaucollector/logs
mkdir -p /usr/local/wftableaucollector/config

cat >/systemd/system/wftableaucollector.service
[Unit]
Description=wftableaucollector - collects data from all views in a given workbook with Tableau REST API and publishes them to Tanzu Observability
Documentation=https://github.com/krisclarkdev/wf-tableau-collector
After=network.target

[Service]
Environment=NODE_PORT=3000
Environment=TABLEAU_COLLECTOR_TABLEAU_PROPS=/usr/local/wftableaucollector/config/tableau.properties
Environment=TABLEAU_COLLECTOR_AUT_XML=/usr/local/wftableaucollector/config/tableauLogin.xml
Environment=TABLEAU_COLLECTOR_WF_PROPS=/usr/local/wftableaucollector/config/wavefront.properties
Enviornment=WF_TABLEAU_COLLECTOR_LOG_LOCATION=/usr/local/wftableaucollector/logs
Type=simple
ExecStart=/usr/local/wf-tableau-collector/wf-tableau-collector
Restart=on-failure

[Install]
WantedBy=multi-user.target


[Service]
Type=simple
ExecStart=/usr/local/bin/wftableaucollector-linux
WorkingDirectory=/usr/local/bin
Restart=always
RestartSec=5
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=%n
EOL

cat >/usr/local/wftableaucollector/config/tableau.properties
username=CHANGEME
password=CHANGEME
api_version=CHANGEME
contentUrl=CHANGEME
base_url=https://CHANGEME/api
endpoint.auth=/auth/signin
endpoint.sites=/sites
endpoint.views=/sites/dummysite/views
endpoint.views.data=/sites/dummysite/views/dummyview/data
endpoint.workbooks.views=/sites/dummysite/workbooks/dummyworkbook
EOL

cat >/usr/local/wftableaucollector/config/tableauLogin.xml
<tsRequest>
    <credentials name="dummyuserdonottouch" password="dummypassdonottouch" >
        <site contentUrl="dummyContentUrldonottouch" />
    </credentials>
</tsRequest>
EOL

cat >/usr/local/wftableaucollector/config/wavefront.properties
wavefront.token=CHANGEME
wavefront.url=CHANGEME
metric.source=tableau-collector
metric.prefix=tableau.collector
EOL
